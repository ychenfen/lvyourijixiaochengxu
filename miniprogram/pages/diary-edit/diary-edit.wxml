<!--æ—¥è®°ç¼–è¾‘é¡µ-->
<view class="page">
  <!-- æ ‡é¢˜è¾“å…¥ -->
  <view class="form-item">
    <input class="title-input" placeholder="è¾“å…¥æ—¥è®°æ ‡é¢˜" value="{{title}}" bindinput="onTitleInput" maxlength="50"/>
    <text class="char-count">{{title.length}}/50</text>
  </view>

  <!-- å†…å®¹è¾“å…¥ -->
  <view class="form-item">
    <textarea 
      class="content-input" 
      placeholder="è®°å½•ä½ çš„æ—…è¡Œæ•…äº‹..." 
      value="{{content}}" 
      bindinput="onContentInput"
      maxlength="5000"
      auto-height
    ></textarea>
    <text class="char-count">{{content.length}}/5000</text>
  </view>

  <!-- å›¾ç‰‡ä¸Šä¼  -->
  <view class="form-item">
    <view class="section-title">
      <text>æ·»åŠ å›¾ç‰‡</text>
      <text class="text-gray text-sm">ï¼ˆæœ€å¤š9å¼ ï¼‰</text>
    </view>
    <view class="image-upload">
      <view class="image-item" wx:for="{{images}}" wx:key="index">
        <image class="uploaded-image" src="{{item}}" mode="aspectFill" bindtap="previewImage" data-index="{{index}}"></image>
        <view class="delete-btn" catchtap="deleteImage" data-index="{{index}}">Ã—</view>
      </view>
      <view class="add-image" bindtap="chooseImage" wx:if="{{images.length < 9}}">
        <text class="add-icon">+</text>
        <text class="add-text">æ·»åŠ å›¾ç‰‡</text>
      </view>
    </view>
  </view>

  <!-- ä½ç½®é€‰æ‹© -->
  <view class="form-item" bindtap="chooseLocation">
    <view class="location-picker">
      <text class="picker-icon">ğŸ“</text>
      <text class="picker-text {{location ? '' : 'placeholder'}}">{{location.name || 'é€‰æ‹©ä½ç½®'}}</text>
      <text class="picker-arrow">></text>
    </view>
  </view>

  <!-- å¤©æ°”ä¿¡æ¯ -->
  <view class="form-item">
    <view class="weather-info" wx:if="{{weather}}">
      <text class="weather-icon">{{weather.icon}}</text>
      <text class="weather-text">{{weather.description}} {{weather.temperature}}Â°C</text>
      <text class="weather-auto">è‡ªåŠ¨è·å–</text>
    </view>
    <view class="weather-loading" wx:else>
      <text>æ­£åœ¨è·å–å¤©æ°”ä¿¡æ¯...</text>
    </view>
  </view>

  <!-- æäº¤æŒ‰é’® -->
  <view class="submit-area">
    <button class="btn btn-primary btn-block" bindtap="saveDiary" disabled="{{saving}}">
      {{saving ? 'ä¿å­˜ä¸­...' : (isEdit ? 'ä¿å­˜ä¿®æ”¹' : 'å‘å¸ƒæ—¥è®°')}}
    </button>
  </view>
</view>
