<!--æ—¥è®°è¯¦æƒ…é¡µ-->
<view class="page" wx:if="{{diary}}">
  <!-- å°é¢å›¾ -->
  <swiper class="cover-swiper" wx:if="{{diary.images && diary.images.length > 0}}" indicator-dots="{{diary.images.length > 1}}" autoplay circular>
    <swiper-item wx:for="{{diary.images}}" wx:key="index">
      <image class="cover-image" src="{{item}}" mode="aspectFill" bindtap="previewImage" data-url="{{item}}"></image>
    </swiper-item>
  </swiper>
  <view class="cover-placeholder" wx:else>
    <text>ğŸ“”</text>
  </view>

  <!-- å†…å®¹åŒºåŸŸ -->
  <view class="content-area">
    <!-- æ ‡é¢˜å’Œæ—¥æœŸ -->
    <view class="header">
      <text class="title">{{diary.title}}</text>
      <text class="date">{{diary.createTimeText}}</text>
    </view>

    <!-- ä½ç½®å’Œå¤©æ°” -->
    <view class="meta-info">
      <view class="meta-item" wx:if="{{diary.locationName}}" bindtap="openLocation">
        <text class="meta-icon">ğŸ“</text>
        <text class="meta-text">{{diary.locationName}}</text>
      </view>
      <view class="meta-item" wx:if="{{diary.weather}}">
        <text class="meta-icon">{{diary.weatherIcon || 'ğŸŒ¤ï¸'}}</text>
        <text class="meta-text">{{diary.weather}} {{diary.temperature}}</text>
      </view>
    </view>

    <!-- æ­£æ–‡å†…å®¹ -->
    <view class="content">
      <text class="content-text">{{diary.content}}</text>
    </view>

    <!-- å›¾ç‰‡åˆ—è¡¨ -->
    <view class="image-grid" wx:if="{{diary.images && diary.images.length > 0}}">
      <image 
        class="grid-image {{diary.images.length === 1 ? 'single' : ''}}" 
        wx:for="{{diary.images}}" 
        wx:key="index" 
        src="{{item}}" 
        mode="aspectFill"
        bindtap="previewImage"
        data-url="{{item}}"
      ></image>
    </view>
  </view>

  <!-- åº•éƒ¨æ“ä½œæ  -->
  <view class="action-bar">
    <view class="action-item" bindtap="editDiary">
      <text class="action-icon">âœï¸</text>
      <text class="action-text">ç¼–è¾‘</text>
    </view>
    <view class="action-item" bindtap="shareDiary">
      <text class="action-icon">ğŸ“¤</text>
      <text class="action-text">åˆ†äº«</text>
    </view>
    <view class="action-item" bindtap="deleteDiary">
      <text class="action-icon">ğŸ—‘ï¸</text>
      <text class="action-text">åˆ é™¤</text>
    </view>
  </view>
</view>

<!-- åŠ è½½çŠ¶æ€ -->
<view class="loading-state" wx:elif="{{loading}}">
  <text>åŠ è½½ä¸­...</text>
</view>

<!-- é”™è¯¯çŠ¶æ€ -->
<view class="error-state" wx:else>
  <text class="error-icon">ğŸ˜•</text>
  <text class="error-text">æ—¥è®°ä¸å­˜åœ¨æˆ–å·²åˆ é™¤</text>
  <button class="btn btn-primary" bindtap="goBack">è¿”å›</button>
</view>
